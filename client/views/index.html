<html>
	<head>
		<title>Angular Customers</title>
		<link rel="stylesheet" href="../static/css/materialize.css">
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
		<script type='text/javascript'>
		var customerModule = angular.module('CustomerApp', []);

		customerModule.factory('customerFactory', function(){
			var customers = [];

			var factory = {};
			factory.getCustomers = function(callback){
				callback(customers);
			}

			return factory;
		})
		customerModule.controller('customersController', function($scope, customerFactory){
			$scope.customers = [];

			customerFactory.getCustomers(function(data){
				$scope.customers = data;
			})
			$scope.addCustomer = function(){
				$scope.error = '';
				for(var customer in $scope.customers){
					if($scope.customers[customer].name == $scope.newCustomer.name){
						$scope.error = 'Name already exists';
						return false;
					}
				}
				var customer = {name: $scope.newCustomer.name, created_at: new Date().toDateString()};
				$scope.customers.push(customer);

				$scope.newCustomer = {};
			}
			$scope.removeCustomer = function(customer){
				$scope.customers.splice($scope.customers.indexOf(customer), 1);
			}

		});

		

		</script>
	</head>
	<body ng-app='CustomerApp'>
		<div ng-controller="customersController">
		<div class="container">
			<div class="row">
				<div class="col s6">
					<h3>Add new customer:</h3>
					<h5>Customer Name:</h5>
					<div class="input-field">
						<input type="text" ng-model='newCustomer.name'>
						<button class='btn btn-medium blue' ng-click='addCustomer()'>Add</button>

					</div>
				</div>
			</div>
		</div>
		<div class="container">
			<div class="row">
				<div class="col s3 offset-s9">
					<h5>Search</h5>
					<div class="input-field">
						<input type="text" ng-model="filter_created_at">
					</div>
				</div>
			</div>
			<div ng-bind="error" style='color:red'></div>
			<div class="row">
				<div class="col s12">
					<table class='striped'>
						<thead>
							<th>Customer Name</th>
							<th>Created Date</th>
							<th>Actions</th>
						</thead>
						<tbody>
							<tr ng-repeat="customer in customers track by customer.name| filter: filter_created_at | orderBy: 'name'">
								<td>{{customer.name}}</td>
								<td>{{customer.created_at}}</td>
								<td><a ng-click='removeCustomer(customer)'>Remove Customer</a><td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	</body>
</html>